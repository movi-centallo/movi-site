---
import Hero from "@components/hero.astro";
import Layout from "@layouts/Layout.astro";
import Introgrid from "@components/introgrid.astro";
import ProjectsMaster from "@components/ProjectsMaster.astro";
import ModalDialog from "@components/ModalDialog.astro";

import { contentfulClient } from "../lib/contentful";
import type Progetti from "../lib/types.ts"

const showModal = true; // Cambia a false per nascondere la dialog relativa ai cantoni
const rawEntries = await contentfulClient.getEntries<Progetti>({
  content_type: "progetti",
});

const orderedEntries = {
  ...rawEntries,
  items: rawEntries.items
    .sort((a, b) => {
      // Ordina per startingDate (ISO string)
      return new Date(a.fields.startingDate).getTime() - new Date(b.fields.startingDate).getTime();
    })
    .slice(0, 4)
};

---
<script>
  // Show modal when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('my_modal_3');
    if (modal) {
      // @ts-ignore - The showModal() method exists on HTMLDialogElement
      modal.showModal();
    }
  });
</script>

<Layout title="Movi Centallo">
  
  <div class="container mx-auto px-5">
    <!-- Open the modal using ID.showModal() method -->

   
    <ModalDialog show={showModal} />

    <Hero />
    <Introgrid />
    <ProjectsMaster entries={orderedEntries.items}></ProjectsMaster>

  </div>  
  
</Layout>
